<!doctype html>

<html lang="en">

<head>

<meta charset="utf-8" />

<meta name="viewport" content="width=device-width,initial-scale=1" />

<title>Bloomscroll — Infinite Calm Feed</title>

<meta name="description" content="Bloomscroll is an ultra-minimal, Apple-style infinite video feed powered by Google Sheets." />



<style>

:root{

  --bg:#0a0b0d;

  --panel:rgba(255,255,255,0.035);

  --border:rgba(255,255,255,0.06);

  --muted:rgba(255,255,255,0.65);

  --radius-lg:28px;

  --radius-md:18px;

  --shadow:0 35px 90px rgba(0,0,0,0.7);

  --max:960px;

  font-family:-apple-system,BlinkMacSystemFont,"SF Pro Display","SF Pro Text","Segoe UI",Roboto,Helvetica,Arial,sans-serif;

}



*{box-sizing:border-box}

html,body{margin:0;height:100%;background:var(--bg);color:#fff}



body{

  display:flex;

  justify-content:center;

  padding:22px;

}



.app{

  width:100%;

  max-width:var(--max);

  height:calc(100vh - 44px);

  background:linear-gradient(180deg,rgba(255,255,255,0.04),rgba(255,255,255,0.015));

  border-radius:var(--radius-lg);

  border:1px solid var(--border);

  box-shadow:var(--shadow);

  overflow:hidden;

  display:flex;

  flex-direction:column;

}



header{

  height:68px;

  padding:0 22px;

  display:flex;

  align-items:center;

  justify-content:space-between;

  border-bottom:1px solid rgba(255,255,255,0.05);

  backdrop-filter:blur(10px);

}



.brand{

  display:flex;

  align-items:center;

  gap:12px;

  font-weight:600;

  letter-spacing:.2px;

}



.mark{

  width:14px;height:14px;border-radius:4px;

  background:linear-gradient(180deg,#fff,#cfcfcf);

}



.subtitle{font-size:12px;color:var(--muted)}



.feed{

  flex:1;

  overflow-y:auto;

  padding:24px;

  display:flex;

  flex-direction:column;

  gap:24px;

  scroll-behavior:smooth;

}



.card{

  background:var(--panel);

  border:1px solid rgba(255,255,255,0.04);

  border-radius:var(--radius-md);

  overflow:hidden;

  transition:transform .25s ease, box-shadow .25s ease;

}



.card:hover{

  transform:translateY(-6px);

  box-shadow:0 26px 70px rgba(0,0,0,0.6);

}



.media{

  width:100%;

  aspect-ratio:16/9;

  background:#050506;

  display:flex;

  align-items:center;

  justify-content:center;

}



.media iframe,.media video{

  width:100%;height:100%;border:0;display:block;

}



.meta{

  padding:12px 14px;

  font-size:13px;

  display:flex;

  justify-content:space-between;

  align-items:center;

  color:var(--muted);

}



.loader{

  width:34px;height:34px;border-radius:50%;

  border:3px solid rgba(255,255,255,0.12);

  border-top-color:#fff;

  animation:spin 1s linear infinite;

}



@keyframes spin{to{transform:rotate(360deg)}}



.empty{

  text-align:center;

  color:var(--muted);

  margin-top:80px;

}



@media(max-width:720px){

  body{padding:14px}

  .feed{padding:16px}

}

</style>

</head>

<body>



<div class="app">

  <header>

    <div class="brand">

      <div class="mark"></div>

      <div>

        Bloomscroll

        <div class="subtitle">infinite calm feed</div>

      </div>

    </div>

    <div class="subtitle">No login</div>

  </header>



  <main class="feed" id="feed">

    <!-- Preference Modal -->

    <div class="overlay" id="prefOverlay" style="position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.55);backdrop-filter:blur(12px);z-index:50">

      <div style="background:linear-gradient(180deg,rgba(255,255,255,.08),rgba(255,255,255,.03));border:1px solid rgba(255,255,255,.1);border-radius:26px;padding:26px;width:min(92%,440px);box-shadow:0 40px 120px rgba(0,0,0,.8)">

        <h3 style="margin:0 0 6px;font-weight:600">Choose your flow</h3>

        <p style="margin:0 0 18px;font-size:13px;color:var(--muted)">Pick a category and how long you want to scroll</p>



        <div id="catOptions" style="display:flex;flex-wrap:wrap;gap:10px;margin-bottom:22px"></div>



        <div style="font-size:13px;color:var(--muted);margin-bottom:10px">Session length</div>

        <div id="countOptions" style="display:flex;gap:12px">

          <button class="count-pill" data-count="5">5 reels</button>

          <button class="count-pill" data-count="10">10 reels</button>

          <button class="count-pill" data-count="20">20 reels</button>

          <button class="count-pill" data-count="inf">Infinite</button>

        </div>



        <button id="startBtn" style="margin-top:22px;width:100%;padding:14px;border-radius:16px;border:0;font-weight:700;background:#fff;color:#000">Start watching</button>

      </div>

    </div>



    <div class="empty">

      <div style="margin-bottom:12px">Blooming videos…</div>

      <div class="loader"></div>

    </div>

  </main>

</div>



<script>

// ================================

// BLOOMSCROLL CORE — FIXED

// ================================



// 1️⃣ Google Sheets CSV URL

const SHEET_CSV_URL = "https://docs.google.com/spreadsheets/d/10QQVEXVhQ_p7kO4DyIGzDXfEmQzNNFkV4iC3i_MSmLw/export?format=csv";



const feed = document.getElementById('feed');



// CSV parser — fixed for Windows/Unix line endings

const parseCSV = text => {

  const rows = text.split(/\r?\n/).slice(1).filter(Boolean);

  return rows.map(r=>{

    const [url, platform, category] = r.split(',').map(x=>x?.trim());

    return { url, platform, category };

  }).filter(r=>r.url && r.platform);

};



// YouTube ID extractor

const getYouTubeID = url => {

  try{

    const u = new URL(url);

    return u.searchParams.get('v') || url.split('/').pop();

  }catch{return null}

}



// Create a video card

function createCard(url){

  const card = document.createElement('article');

  card.className = 'card';

  card.dataset.url = url;



  const media = document.createElement('div');

  media.className = 'media';

  media.innerHTML = '<div class="loader"></div>';



  const meta = document.createElement('div');

  meta.className = 'meta';

  meta.textContent = new URL(url).hostname;



  card.append(media, meta);

  return card;

}



// ================================

// YOUTUBE AUTO-NEXT

// ================================

let ytPlayers = {};



function loadYouTubeAPI(){

  return new Promise(resolve=>{

    if (window.YT && window.YT.Player) return resolve();

    const s = document.createElement('script');

    s.src = 'https://www.youtube.com/iframe_api';

    window.onYouTubeIframeAPIReady = () => resolve();

    document.body.appendChild(s);

  });

}



function scrollToNext(card){

  const next = card.nextElementSibling;

  if (next) next.scrollIntoView({ behavior:'smooth', block:'start' });

}



// Intersection observer for lazy load

const observer = new IntersectionObserver(entries => {

  entries.forEach(entry => {

    if (!entry.isIntersecting) return;

    const card = entry.target;

    if (card.dataset.loaded) return;



    const url = card.dataset.url;

    const yt = getYouTubeID(url);



    if (yt) {

      const iframe = document.createElement('iframe');

      iframe.src = `https://www.youtube.com/embed/${yt}?enablejsapi=1&playsinline=1&rel=0`;

      iframe.allow = 'autoplay; encrypted-media';



      const media = card.querySelector('.media');

      media.innerHTML = '';

      media.appendChild(iframe);



      loadYouTubeAPI().then(()=>{

        ytPlayers[yt] = new YT.Player(iframe,{

          events:{

            onStateChange:e=>{

              if (e.data === YT.PlayerState.ENDED){

                scrollToNext(card);

              }

            }

          }

        });

      });

    } else {

      card.querySelector('.media').innerHTML = `<a href="${url}" target="_blank">Open video</a>`;

    }



    card.dataset.loaded = '1';

  });

},{ threshold:0.6 });



// ================================

// INIT FUNCTION — FIXED

// ================================

let allReels = [];

let sessionLimit = null;

let shownCount = 0;



async function init(){

  try{

    const res = await fetch(SHEET_CSV_URL);

    const text = await res.text();



    const rows = parseCSV(text);

    allReels = rows;



    feed.innerHTML = '';



    if (!allReels.length) {

      feed.innerHTML = `<div class="empty">No videos found in sheet</div>`;

      return;

    }



    allReels.forEach(item => {

      const card = createCard(item.url);

      feed.appendChild(card);

      observer.observe(card);

      shownCount++;

    });



  } catch(err){

    console.error(err);

    feed.innerHTML = `<div class="empty">Failed to load Google Sheet</div>`;

  }

}



init();



// ================================

// Optional fallback for videos near end

// ================================

function attachEndFallback(player, card){

  let checked = false;

  const interval = setInterval(()=>{

    if (!player || !player.getDuration) return;

    const d = player.getDuration();

    const t = player.getCurrentTime();

    if (d && t && d - t < 0.4 && !checked){

      checked = true;

      clearInterval(interval);

      scrollToNext(card);

    }

  }, 500);

}

</script>



</body>

</html>




